# 更新日志

## v3.0.0 (2024-09-15)

### 🚀 重大更新

#### 新增功能

-   **智能分片系统**：支持大型数据库文件自动分片，优化内存使用
-   **多格式压缩支持**：支持 gzip、zip、zstd 多种压缩格式
-   **智能压缩算法**：压缩率高达 81%，大幅减少存储空间
-   **分片数据库助手**：自动合并分片文件，支持缓存机制
-   **快速模式**：跳过压缩以提升分片速度
-   **智能分片算法**：动态调整分片大小，确保分片均匀分布

#### 性能优化

-   **内存优化**：使用分块写入避免大文件内存溢出
-   **缓存优化**：智能缓存机制，避免重复合并
-   **查询优化**：支持 IPv4 和 IPv6 双协议查询
-   **加载优化**：懒加载机制，按需创建查询器

#### 技术改进

-   **错误处理**：完善的错误处理和异常管理
-   **文件管理**：支持多种数据库格式和版本检测
-   **代码质量**：完整的 PHPDoc 注释和文档
-   **兼容性**：兼容 PHP 5.4+，零依赖

### 📊 压缩效果

| 数据库版本 | 原始大小 | 压缩后大小 | 压缩率 | 分片数量 |
| ---------- | -------- | ---------- | ------ | -------- |
| IPv4       | 10.5MB   | 4.1MB      | 61%    | 1 个     |
| IPv6       | 617.1MB  | 115.6MB    | 81.3%  | 21 个    |

### 🛠️ 工具更新

#### 分片工具 (tools/split_db.php)

-   支持多种压缩格式
-   智能分片大小调整
-   快速模式选项
-   详细的进度显示

#### 合并助手 (src/ChunkedDbHelper.php)

-   自动分片文件查找
-   智能版本检测
-   内存优化处理
-   缓存管理机制

### 📚 文档更新

-   **完整注释**：所有 PHP 文件添加了详细的 PHPDoc 注释
-   **使用示例**：提供了丰富的使用示例和最佳实践
-   **API 文档**：完整的 API 参考文档
-   **README 更新**：详细的功能说明和使用指南

### 🔧 配置更新

#### Composer 配置

-   更新项目描述和关键词
-   添加快速模式脚本
-   优化自动加载配置

#### 项目结构

```
ip2region/
├── src/                    # 核心源码
│   ├── Ip2Region.php      # 主类，支持IPv4/IPv6双协议
│   ├── XdbSearcher.php    # XDB搜索引擎
│   └── ChunkedDbHelper.php # 分片数据库助手
├── tools/                  # 工具脚本
│   ├── split_db.php       # 数据库分片工具
│   ├── ip2region_v4.xdb   # IPv4数据库
│   └── ip2region_v6.xdb   # IPv6数据库
├── tests/                  # 测试文件
│   └── demo.php           # 演示脚本
├── db/                     # 分片数据库存储
└── vendor/                 # Composer依赖
```

### 🎯 使用建议

#### 推荐配置

```bash
# 标准压缩模式（推荐）
php tools/split_db.php v6 50 gzip

# 快速模式（无压缩）
php tools/split_db.php v6 100 gzip fast

# 最大压缩（分片较多）
php tools/split_db.php v6 30 gzip
```

#### Composer 脚本

```bash
# 运行演示
composer demo

# 测试IPv4查询
composer test:ipv4

# 测试IPv6查询
composer test:ipv6

# 分片IPv6数据库
composer split:v6

# 快速分片模式
composer split:v6:fast
```

### 🐛 修复问题

-   修复分片合并时的大小计算错误
-   修复重复分片文件问题
-   修复内存溢出问题
-   修复 IPv4 和 IPv6 数据库识别问题

### 📈 性能提升

-   **查询速度**：毫秒级响应时间
-   **内存使用**：优化后内存使用稳定
-   **存储空间**：压缩后减少 81%存储空间
-   **加载速度**：分片加载大幅提升启动速度

---

## v1.0.0 (2022-06-21)

### 初始版本

-   基于官方 ip2region 的基础功能
-   支持 IPv4 和 IPv6 查询
-   基本的缓存机制
-   简单的 API 接口
